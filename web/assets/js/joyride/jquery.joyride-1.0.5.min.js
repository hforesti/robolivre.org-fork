/*
 * jQuery Joyride Plugin 1.0.5
 * www.ZURB.com/playground
 * Copyright 2011, ZURB
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
*/

(function(a){a.fn.joyride=function(b){var c={tipLocation:"bottom",scrollSpeed:300,timer:0,startTimerOnClick:false,nextButton:true,tipAnimation:"pop",tipAnimationFadeSpeed:300,cookieMonster:false,cookieName:"JoyRide",cookieDomain:false,tipContainer:"body",inline:false,tipContent:"#joyRideTipContent",postRideCallback:a.noop,postStepCallback:a.noop};var b=a.extend(c,b);return this.each(function(){if(a(b.tipContent).length===0)return;a(b.tipContent).hide();var d=a(b.tipContainer).children("*").first().position(),e=a(b.tipContent+" li"),f=skipCount=0,g=-1,h,i='<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>';var j=function(b,c,d,e){return'<div class="joyride-tip-guide '+b+'" id="joyRidePopup'+c+'"><span class="joyride-nub"></span><div class="joyride-content-wrapper">'+a(e).html()+d+'<a href="#close" class="joyride-close-tip">X</a>'+h+"</div></div>"};var k=function(d,e,f,g){if(e==0&&c.startTimerOnClick&&c.timer>0||c.timer==0){h=""}else{h=i}if(!d){d=""}if(f){f='<a href="#" class="joyride-next-tip small nice radius yellow button">'+f+"</a>"}else{f=""}if(c.inline){a(j(d,e,f,g)).insertAfter("#"+a(g).data("id"))}else{a(b.tipContainer).append(j(d,e,f,g))}};if(!c.cookieMonster||!a.cookie(c.cookieName)){e.each(function(b){var d=a(this).data("text"),e=a(this).attr("class"),f=this;if(c.nextButton&&!d){d="Next"}if(c.nextButton||!c.nextButton&&c.startTimerOnClick){if(a(this).attr("class")){k(e,b,d,f)}else{k(false,b,d,f)}}else if(!c.nextButton){if(a(this).attr("class")){k(e,b,"",f)}else{k(false,b,"",f)}}a("#joyRidePopup"+b).hide()})}showNextTip=function(){var b=a(e[f]).data("id"),h=a("#"+b),i={};a.each((a(e[f]).data("options")||":").split(";"),function(b,c){var d=c.split(":");if(d.length==2){i[a.trim(d[0])]=a.trim(d[1])}});var j=a.extend({},c,i);while(h.offset()===null){f++;skipCount++;if(e.length-1>g){g++}b=a(e[f]).data("id"),h=a("#"+b);if(a(e).length<f){break}}var k=Math.ceil(a(window).height()/2),l=a("#joyRidePopup"+f),m=h.offset(),n=h.outerHeight(),o=l.outerHeight(),p=Math.ceil(a(".joyride-nub").outerHeight()/2),q=0;if(l.length===0){return}if(f<e.length){if(c.tipAnimation=="pop"){a(".joyride-timer-indicator").width(0);if(c.timer>0){l.show().children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:a(".joyride-timer-indicator-wrap").width()},c.timer)}else{l.show()}}else if(c.tipAnimation=="fade"){a(".joyride-timer-indicator").width(0);if(c.timer>0){l.fadeIn(c.tipAnimationFadeSpeed).children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:a(".joyride-timer-indicator-wrap").width()},c.timer)}else{l.fadeIn(c.tipAnimationFadeSpeed)}}var r=l.children(".joyride-nub");var s=m.left-d.left;r.removeClass("bottom").removeClass("top").removeClass("right");if(a(window).scrollLeft()+a(window).width()<s+l.width()){s-=l.width()-r.offset().left*2;r.addClass("right")}if(Modernizr.mq("only screen and (max-width: 769px)")){if(j.tipLocation.indexOf("top")!=-1){if(o>=m.top){l.offset({top:m.top+n+p-d.top});r.addClass("top").css({left:s})}else{l.offset({top:m.top-(o+d.top+p)});r.addClass("bottom").css({left:s})}}else{l.offset({top:m.top+n+p});r.addClass("top").css({left:s})}}else{if(j.tipLocation=="top"){if(o>=m.top){l.offset({top:m.top+n+p-d.top,left:s});r.addClass("top")}else{l.offset({top:m.top-(o+d.top+p),left:s});r.addClass("bottom")}}else{l.offset({top:m.top+n+p,left:s});r.addClass("top")}}if(j.tipLocation.indexOf("right")!=-1){l.offset({left:m.left-d.left-l.width()+h.width()});l.children(".joyride-nub").addClass("right")}q=Math.ceil(l.offset().top-k);a("html, body").animate({scrollTop:q},c.scrollSpeed);if(f>0){if(skipCount>0){var t=g-skipCount;skipCount=0}else{var t=g}if(c.tipAnimation=="pop"){a("#joyRidePopup"+t).hide()}else if(c.tipAnimation=="fade"){a("#joyRidePopup"+t).fadeOut(c.tipAnimationFadeSpeed)}}}else if(e.length-1<f){var u;if(skipCount>0){t=g-skipCount;skipCount=0}else{t=g}if(c.cookieMonster==true){a.cookie(c.cookieName,"ridden",{expires:365,domain:c.cookieDomain})}if(c.tipAnimation=="pop"){a("#joyRidePopup"+t).fadeTo(0,0)}else if(c.tipAnimation=="fade"){a("#joyRidePopup"+t).fadeTo(c.tipAnimationFadeSpeed,0)}}f++;if(g<0){g=0}else if(e.length-1>g){g++}if(c.postStepCallback!=a.noop){c.postStepCallback(g)}};if(!c.inline||!c.cookieMonster||!a.cookie(c.cookieName)){a(window).resize(function(){var b=a(e[g]).data("id"),f=a("#"+b).offset(),h=a("#"+b).outerHeight(),i=a("#joyRidePopup"+g).outerHeight(),j=Math.ceil(a(".joyride-nub").outerHeight()/2);if(Modernizr.mq("only screen and (max-width: 769px)")){if(c.tipLocation=="bottom"){a("#joyRidePopup"+g).offset({top:f.top+h+j,left:0});a("#joyRidePopup"+g).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:f.left-d.left})}else if(c.tipLocation=="top"){if(f.top<=i){a("#joyRidePopup"+g).offset({top:f.top+j+h,left:0});a("#joyRidePopup"+g).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:f.left-d.left})}else{a("#joyRidePopup"+g).offset({top:f.top-(i+j),left:0});a("#joyRidePopup"+g).children(".joyride-nub").addClass("bottom").removeClass("top").css({left:f.left-d.left})}}}else{if(c.tipLocation=="bottom"){a("#joyRidePopup"+g).offset({top:f.top+h+j,left:f.left});a("#joyRidePopup"+g).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:""})}else if(c.tipLocation=="top"){if(f.top<=i){a("#joyRidePopup"+g).offset({top:f.top+j+h,left:f.left});a("#joyRidePopup"+g).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:""})}else{a("#joyRidePopup"+g).offset({top:f.top-(i+j),left:f.left});a("#joyRidePopup"+g).children(".joyride-nub").addClass("bottom").removeClass("top").css({left:""})}}}})}var l=null,m=false;if(!c.startTimerOnClick&&c.timer>0){showNextTip();l=setInterval(function(){showNextTip()},c.timer)}else{showNextTip()}var n=function(b,d,e,f){b.preventDefault();clearInterval(d);if(e){a.cookie(c.cookieName,"ridden",{expires:365,domain:c.cookieDomain})}a(f).parent().parent().hide();if(c.postRideCallback!=a.noop){c.postRideCallback()}};a(".joyride-close-tip").click(function(a){n(a,l,c.cookieMonster,this)});a(".joyride-next-tip").click(function(a){a.preventDefault();if(f>=e.length){n(a,l,c.cookieMonster,this)}if(c.timer>0&&c.startTimerOnClick){showNextTip();clearInterval(l);l=setInterval(function(){showNextTip()},c.timer)}else if(c.timer>0&&!c.startTimerOnClick){clearInterval(l);l=setInterval(function(){showNextTip()},c.timer)}else{showNextTip()}})})}})(jQuery)
